# NPC 思维系统实施任务清单

- [x] **基础：NpcMind Capability** <!-- id: 0 -->
    - [x] 定义 `INpcMind` 接口（Sensors、Memory、Decision 访问） <!-- id: 1 -->
    - [x] 实现 `NpcMind` capability provider 和存储 <!-- id: 2 -->
    - [x] 将 Capability 附加到 `EntityGuzhenren`（或特定 NPC 实体） <!-- id: 3 -->
- [x] **记忆系统** <!-- id: 4 -->
    - [x] 创建 `MemoryModule`（短期 & 长期记忆） <!-- id: 5 -->
    - [x] 实现 `MemoryEntry`（Key-Value 带过期/重要性） <!-- id: 6 -->
- [x] **决策核心（Utility AI）** <!-- id: 7 -->
    - [x] 定义 `IGoal` 接口（getPriority、canRun、tick） <!-- id: 8 -->
    - [x] 实现 `GoalSelector`（评估器） <!-- id: 9 -->
    - [x] 创建基础目标： <!-- id: 10 -->
        - [x] `SurvivalGoal`（低血量时吃东西/治疗） <!-- id: 11 -->
        - [x] `IdleGoal`（无事可做时闲逛/观察） <!-- id: 12 -->
- [x] **执行层** <!-- id: 13 -->
    - [x] 将 `NpcMind` 决策桥接到原版 `GoalSelector` 或自定义 Action 系统 <!-- id: 14 -->
- [x] **集成与测试平台** <!-- id: 15 -->
    - [x] **调试命令系统** <!-- id: 16 -->
        - [x] 创建 `MindDebugCommand` 类 <!-- id: 18 -->
        - [x] 实现 `inspect` 子命令（显示当前目标、优先级、记忆） <!-- id: 19 -->
        - [x] 注册命令到 `RegisterCommandsEvent` <!-- id: 20 -->
    - [x] **测试物品** <!-- id: 23 -->
        - [x] 创建 `MindInspectorItem` (customNPCs_test) <!-- id: 24 -->
        - [x] 注册测试物品 <!-- id: 25 -->
    - [x] **自动化测试 (GameTests)** <!-- id: 26 -->
        - [x] 创建 `NpcMindGameTests` 类 <!-- id: 27 -->
        - [x] 实现 `testIdleGoal` <!-- id: 28 -->
        - [x] 实现 `testSurvivalGoal` <!-- id: 29 -->
        - [x] 实现 `testMemoryExpiration` (记忆过期) <!-- id: 31 -->
        - [x] 实现 `testMemoryPersistence` (记忆持久化) <!-- id: 32 -->
        - [x] 运行 `runGameTestServer` 验证 <!-- id: 30 -->

- [x] **感知系统 (Sensors)** <!-- id: 33 -->
    - [x] 定义 `ISensor` 接口 <!-- id: 34 -->
    - [x] 实现 `VisionSensor` (视觉传感器) <!-- id: 35 -->
        - [x] 扫描周围实体 <!-- id: 36 -->
        - [x] 视线检测 (Line of Sight) <!-- id: 37 -->
    - [x] 集成传感器到 `NpcMind` 循环 <!-- id: 38 -->
    - [x] 更新记忆模块以存储感知到的信息 <!-- id: 39 -->

- [x] **感知系统测试** <!-- id: 40 -->
    - [x] 创建 `SensorTests` 类 <!-- id: 41 -->
    - [x] 实现 `testVisionSensor` (验证能发现周围实体) <!-- id: 42 -->
    - [x] 验证记忆中是否正确存储了感知数据 <!-- id: 43 -->

- [x] **反应式目标 (Reactive Goals)** <!-- id: 44 -->
    - [x] 实现 `WatchClosestEntityGoal` (注视最近实体) <!-- id: 45 -->
        - [x] 优先级：当有可见实体时提高 <!-- id: 46 -->
        - [x] 行为：调用 `LookControl` 注视目标 <!-- id: 47 -->
    - [x] 集成到 `NpcMindInitializer` <!-- id: 48 -->

- [x] **行为执行层 (Action & Execution)** <!--id:49-->
    - [x] **核心接口** <!--id:50-->
        - [x] 定义 `ActionStatus` 枚举 (RUNNING, SUCCESS, FAILURE) <!--id:51-->
        - [x] 定义 `IAction` 接口 (tick, start, stop) <!--id:52-->
    - [x] **执行器 (Executor)** <!--id:53-->
        - [x] 实现 `ActionExecutor` (队列管理, 状态流转) <!--id:54-->
        - [x] 集成到 `NpcMind` (添加 getActionExecutor, tick 调用) <!--id:55-->
    - [x] **基础动作 (Basic Actions)** <!--id:56-->
        - [x] 实现 `MoveToAction` (导航移动) <!--id:57-->
        - [x] 实现 `LookAtAction` (注视目标) <!--id:58-->
        - [x] 实现 `WaitAction` (延迟等待) <!--id:59-->
    - [x] **验证与测试** <!--id:60-->
        - [x] 创建 `TestPlanGoal` (提交动作序列测试) <!--id:61-->
        - [x] 创建 `ActionTests` (GameTest 验证动作队列) <!--id:62-->

- [x] **规划层 (Planner - GOAP)** <!-- id: 63 -->
    - [x] **核心数据结构** <!-- id: 64 -->
        - [x] 实现 `WorldState` (状态原子集合, match/apply 逻辑) <!-- id: 65 -->
        - [x] 定义 `IGoapAction` (Preconditions, Effects, Cost) <!-- id: 66 -->
    - [x] **规划算法** <!-- id: 67 -->
        - [x] 实现 `GoapPlanner` (A* 搜索算法) <!-- id: 68 -->
    - [x] **集成到决策系统** <!-- id: 69 -->
        - [x] 创建 `PlanBasedGoal` 基类 (自动调用规划器) <!-- id: 70 -->
        - [x] 更新 `NpcMind` 以提供当前 `WorldState` <!-- id: 71 -->
    - [x] **验证与测试** <!-- id: 72 -->
        - [x] 创建 `PlannerTests` (验证简单和链式规划) <!-- id: 73 -->

- [/] **复杂场景集成测试** <!-- id: 74 -->
    - [/] **新增动作与目标** <!-- id: 75 -->
        - [ ] 实现 `PickUpItemAction` (拾取物品) <!-- id: 76 -->
        - [ ] 实现 `DropItemAction` (丢弃物品) <!-- id: 77 -->
        - [ ] 实现 `GatherItemGoal` (搜集物品目标) <!-- id: 78 -->
    - [ ] **场景实现 (GameTests)** <!-- id: 79 -->
        - [ ] 实现 `testTheGatherer` (搜寻者场景) <!-- id: 80 -->
        - [ ] 实现 `testTheCourier` (搬运工场景) <!-- id: 81 -->
    - [ ] **性能评估** <!-- id: 82 -->
        - [ ] 实现 `testPerformanceStress` (压力测试) <!-- id: 83 -->
        - [ ] 记录并分析性能数据 (Planning Time, Tick Lag) <!-- id: 84 -->
