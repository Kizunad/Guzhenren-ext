# NPC 性格系统设计方案：七情六欲 (Seven Emotions & Six Desires)

## 1. 核心理念
基于中国传统文化的“七情六欲”构建 NPC 的性格与情绪模型。
*   **七情 (Emotions)**：**动态**的情绪状态，随环境和事件快速变化（如：喜、怒）。
*   **六欲 (Drives)**：**静态**的性格特征/核心驱动力，决定 NPC 的长期行为偏好（如：贪财、好色、求生）。

此系统将作为 `Utility AI` 的**权重修正层 (Modifier Layer)**，使不同性格的 NPC 在相同处境下做出不同选择。

---

## 2. 数据模型

### 2.1 七情 (Emotions) - 动态状态
取值范围：`0.0` (无) ~ `1.0` (极致)。随时间自然衰减。

| 情绪 | 对应英文 | 触发示例 | 行为影响 (Utility 修正) |
| :--- | :--- | :--- | :--- |
| **喜** | Joy | 获得宝物、突破成功、好友重逢 | ⬆️ 社交、交易 <br> ⬇️ 攻击性 |
| **怒** | Anger | 被攻击、被抢夺、被羞辱 | ⬆️ **攻击 (Attack)**、追击 <br> ⬇️ 逃跑、理智判断 |
| **哀** | Sorrow | 重伤、好友死亡、突破失败 | ⬇️ **所有活跃行为** <br> ⬆️ 发呆、喝酒、哭泣 |
| **惧** | Fear | 面对强敌、低血量、环境危险 | ⬆️ **逃跑 (Flee)**、求饶、躲藏 <br> ⬇️ 攻击、探索 |
| **爱** | Love | 面对好感度高的对象 | ⬆️ 援助、赠送、跟随 <br> ⬇️ 攻击该对象 |
| **恶** | Hate | 面对厌恶对象 | ⬆️ 攻击、陷害、拒绝交互 |
| **欲** | Desire | (作为总情绪强度) | 放大所有行为的积极性 |

### 2.2 六欲 (Drives) - 静态性格
取值范围：`0.0` (无欲) ~ `1.0` (极度渴望)。生成时随机决定，后续变化缓慢。

| 欲望 | 对应概念 | 游戏内含义 | 影响的目标 (Goals) |
| :--- | :--- | :--- | :--- |
| **生** | Survival | **贪生怕死** vs 视死如归 | ⬆️ `SurvivalGoal` (吃药/逃跑) <br> 影响逃跑阈值 |
| **色** | Lust/Social | **社交/伴侣**需求 | ⬆️ `SocialGoal` (搭讪/双修/结拜) |
| **味** | Gluttony | 对**资源/丹药**的贪婪 | ⬆️ `GatherGoal` (采集), `LootGoal` (舔包) |
| **名** | Pride | 对**地位/面子**的追求 | ⬆️ `ChallengeGoal` (挑战), 不愿求饶 |
| **触** | Comfort | 对**舒适/享受**的追求 | ⬆️ `IdleGoal` (找椅子/泡澡), 厌恶恶劣环境 |
| **法** | Knowledge | 对**力量/大道**的追求 | ⬆️ `CultivateGoal` (修炼), `ExploreGoal` (探索遗迹) |

---

## 3. 运作机制

### 3.1 决策公式
`UtilityGoalSelector` 在计算每个 Goal 的最终优先级时，应用性格修正：

```java
float finalPriority = basePriority * (1.0f + getPersonalityModifier(goalType));
```

**修正计算示例**：
假设 NPC 正在考虑 **"逃跑" (FleeGoal)**，基础分 `0.6` (血量偏低)。
*   **性格 (六欲)**: `生(Survival) = 0.9` (非常怕死) -> 提供 `+0.4` 加成。
*   **情绪 (七情)**: `怒(Anger) = 0.8` (非常生气) -> 提供 `-0.3` 减成 (上头了)。
*   **情绪 (七情)**: `惧(Fear) = 0.2` (不太怕) -> 提供 `+0.1` 加成。

**最终修正**: `0.6 * (1 + 0.4 - 0.3 + 0.1) = 0.6 * 1.2 = 0.72`。
结果：比普通 NPC 更容易逃跑，但因为生气可能会犹豫一下。

### 3.2 情绪动态变化 (Event-Driven)
通过监听游戏事件实时更新情绪：

*   `LivingHurtEvent`:
    *   受到伤害 -> **怒** +0.2
    *   伤害来源极其强大 (血量/等级差) -> **惧** +0.3
*   `ItemPickupEvent`:
    *   获得物品 -> **喜** +0.1
    *   物品是其渴望的 (如符合"法"欲的秘籍) -> **喜** +0.5

---

## 4. 实施计划

### 4.1 核心模块
*   `enum EmotionType`, `enum DriveType`
*   `class PersonalityModule`: 存储 Traits 数据，处理衰减 (`tick`)。
*   `interface IPersonality`: Capability 接口。

### 4.2 集成
*   **NpcMind**: 持有 `PersonalityModule`。
*   **UtilityGoalSelector**: 注入 `PersonalityModule`，在 `select()` 时调用修正逻辑。
*   **Sensors**: 传感器可以触发情绪变化（如看到敌人 -> 惧/怒）。

### 4.3 调试与测试
*   `/mind personality`: 查看当前 NPC 的七情六欲数值。
*   **测试用例**:
    *   生成两个 NPC，一个"贪生"(Survival=1.0)，一个"好战"(Pride=1.0)。
    *   给予相同伤害，验证"贪生"者逃跑，"好战"者反击。
